{"componentChunkName":"component---src-templates-post-js","path":"/blogs/007-how-to-scrape-standard-ebooks-using-nodejs/","result":{"data":{"markdownRemark":{"html":"<p class=\"text-md mt-2 mb-8 lg:text-lg dark:text-gray-200\">If you are someone who enjoys reading classic books on your Kindle, you might already be familiar with <a href=\"https://standardebooks.org\">Standard Ebooks</a>.</p>\n<blockquote>\n<p class=\"text-md mt-2 mb-8 lg:text-lg dark:text-gray-200\">Standard Ebooks is a volunteer-driven project that produces new editions of public domain ebooks that are lovingly formatted, open source, free of U.S. copyright restrictions, and free of cost.</p>\n</blockquote>\n<p class=\"text-md mt-2 mb-8 lg:text-lg dark:text-gray-200\">They take ebooks from sources like Project Gutenberg, formats and typesets them using their custom style standards and adds high quality covers to them.</p>\n<p class=\"text-md mt-2 mb-8 lg:text-lg dark:text-gray-200\">However, downloading ebooks from Standard Ebooks and sending them to your Kindle via email can be a bit time-consuming due to manual work involved. As a software developer, I wanted to optimize this process and set out to find if there was any way to automate it. While there are many REST APIs available that expose metadata of the books from Project Gutenberg, I couldn't find any API for fetching metadata from Standard Ebooks. But good old web scraping comes to our rescue here.</p>\n<p class=\"text-md mt-2 mb-8 lg:text-lg dark:text-gray-200\">The Standard Ebooks website is fairly simple to navigate and find all the information I need. So, without wasting any time I fired up my IDE and created a NodeJS project to write a web scraper that would help me with my problem.</p>\n<p class=\"text-md mt-2 mb-8 lg:text-lg dark:text-gray-200\">Here are the detailed steps for you to follow along in case you want to build your own scraper.</p>\n<h2 class=\"text-2xl font-bold mt-2 mb-4 lg:text-3xl dark:text-gray-100\">Step 1: Initialize the npm project and install puppeteer as a dependency</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> init <span class=\"token parameter variable\">-y</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">npm</span> <span class=\"token function\">install</span> puppeteer</code></pre></div>\n<h2 class=\"text-2xl font-bold mt-2 mb-4 lg:text-3xl dark:text-gray-100\">Step 2: Create an index.js file and add the following code in it</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> puppeteer <span class=\"token keyword\">from</span> <span class=\"token string\">'puppeteer'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">scrapeStandardEBooks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> browser <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> puppeteer<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">headless</span><span class=\"token operator\">:</span> <span class=\"token string\">'new'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">waitForInitialPage</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> targetURL <span class=\"token operator\">=</span> <span class=\"token string\">'https://standardebooks.org/ebooks'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">goto</span><span class=\"token punctuation\">(</span>targetURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p class=\"text-md mt-2 mb-8 lg:text-lg dark:text-gray-200\">In the above code, we create a function called <code class=\"language-text\">scrapeStandardEbooks</code> to get started. The code is fairly straightforward. First, we initialize a new browser instance using the <code class=\"language-text\">puppeteer.launch()</code> function by passing it some options. Then we define targetURL and open a new page via the headless browser instance and navigate to the targetURL.</p>\n<h2 class=\"text-2xl font-bold mt-2 mb-4 lg:text-3xl dark:text-gray-100\">Step 3: Find the required book metadata</h2>\n<p class=\"text-md mt-2 mb-8 lg:text-lg dark:text-gray-200\">Standard Ebooks displays the list of ebooks in <code class=\"language-text\">li</code> elements wrapped by an <code class=\"language-text\">ol</code> element with the classes <code class=\"language-text\">grid</code> and <code class=\"language-text\">ebooks-list</code>.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/99972cb36f7b54cafae4fa1046800b94/f9c26/screenshot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACwUlEQVQozy2Sa2/bdBSH8wm4bOvaNLHjOI4d3+3YiZ3UTVLn0nSjLMk2gbaqY0iTkBBbVVWTuA0JhAS8H5cS3nDZECDQ3iAh8UX4NA//ZHtx5Dc+z/k95/wLyf6c+dmXvPHgEW+dfUw6XdCwPEytQlXapiJJ1K0mvX7Gp6czjl7rcG3axWmmJO0Ot96+x92zRyzunmL5bQr9+W3eXT7j4fI3vvr1GcMbd9D1Bp58kUF9g8TYQtE9Zoc5//39Hj+80+PePKXZTun1+hiGwZXrtzj77DGm06Swuzjm9Om/fLL8hQ+++5G9xRGabnLp4iv03SJ3pg6WG3FwJeePx8ecf36bxc2raKZPPj5gY2uLZnfM+18ssbzoOfDhk3/46PxnPhTAXABrdZMLF17m8qWXUKUNTDsUTSneIKJqudT8JqYX44UJdU3FF/pZPsMNWgL4+ps8+OYpJ1//xMm3T9YJq6pBubSN77mUSkUaAthwA7YUBdWweXWzhBUk2LZDHNgMsi62XsMVAwq9+RH3v/+Tk/Pfub/8i8H1Y/SGSzYYczi7SbIzECotUTHt7oD9qzM8kcgUa4iSbK09OTgk64+eA91WRmt4SJJPiff20W0fparRMB08oeaIZDXNoFrTMYWu64VohoWkaBS3y5QkBbmiosjV9bcQhF12Wjlp3Me3mxh1RzQG6IaDKtRX+zR0sTe5RkkAymVZXNaiLg6n1urinzryCvaiClHUI9+9Rjc5IG0NacUj4ignjnPCcBfDjkTKBLMqUpUqFIulNcTQbORyZT3ANG0aYkixWKZgmR474R7dcEzH75GGE5JgRDvYI/A6WOKR11eK0qq5QqVSFUAdaVulvCmxebkoVFfpVGEgU/BXy25monaJ/Q6xSBWHGVGwI66croGO46NpumhSBHhVMuNJynQ6ZH8yZDIeMhplKIrM/wTOcuArB4kxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screenshot\"\n        title=\"Screenshot\"\n        src=\"/static/99972cb36f7b54cafae4fa1046800b94/e7448/screenshot.png\"\n        srcset=\"/static/99972cb36f7b54cafae4fa1046800b94/0608e/screenshot.png 225w,\n/static/99972cb36f7b54cafae4fa1046800b94/31401/screenshot.png 450w,\n/static/99972cb36f7b54cafae4fa1046800b94/e7448/screenshot.png 900w,\n/static/99972cb36f7b54cafae4fa1046800b94/9ac8b/screenshot.png 1350w,\n/static/99972cb36f7b54cafae4fa1046800b94/28bdc/screenshot.png 1800w,\n/static/99972cb36f7b54cafae4fa1046800b94/f9c26/screenshot.png 2880w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p class=\"text-md mt-2 mb-8 lg:text-lg dark:text-gray-200\">Now that we've figured out the structure of the webpage, let's quickly move on to finding the cover image, URL of the book details page, title, author, and the link for downloading the book in epub format.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">scrapeStandardEBooks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ... Previous code ...</span>\n\n  <span class=\"token keyword\">const</span> bookItems <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">$$eval</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ol.ebooks-list.grid li'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">elements</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    elements<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> element<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[property=\"schema:name\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">author</span><span class=\"token operator\">:</span> element<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[property=\"schema:author\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">cover</span><span class=\"token operator\">:</span> element<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[property=\"schema:image\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> element<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[property=\"schema:url\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>href\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p class=\"text-md mt-2 mb-8 lg:text-lg dark:text-gray-200\">After find the URL for all the books, we create an array of <code class=\"language-text\">bookItems</code> that contains the metadata in the following format:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Book 1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Author 1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"cover\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"url for cover image here\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://standardebooks.org/ebooks/author-1/book-1/\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 class=\"text-2xl font-bold mt-2 mb-4 lg:text-3xl dark:text-gray-100\">Step 4: Construct the download URLs for the books</h2>\n<p class=\"text-md mt-2 mb-8 lg:text-lg dark:text-gray-200\">Now comes the more interesting part. The ebooks listing page does not contain download links for the books. The only way to fetch the correct download link is to navigate to a book's URL and then look for the download link on that page. This is not very nice because it means we have to repeat this process for every single book.</p>\n<p class=\"text-md mt-2 mb-8 lg:text-lg dark:text-gray-200\">However, download links can easily be constructed from the URLs of the books. The following code extracts the author, title (and translator(s) if there are any) from a book's URL and constructs its corresponding download URL.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">scrapeStandardEBooks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ... Previous code ...</span>\n\n  <span class=\"token keyword\">let</span> books <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> bookItem <span class=\"token keyword\">of</span> bookItems<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// The logic for predicting downloadURL based on the bookUrl</span>\n    <span class=\"token keyword\">let</span> downloadUrl <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> regex <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\/ebooks\\/([^\\/]+)\\/([^\\/]+)(\\/([^\\/]+))?$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> match <span class=\"token operator\">=</span> bookItem<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>regex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>match<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> author<span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">,</span> translator<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> match<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> downloadPath <span class=\"token operator\">=</span> translator\n        <span class=\"token operator\">?</span> <span class=\"token comment\">// This is needed for books translated by a person different from the author</span>\n          <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>author<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>translator<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.epub</span><span class=\"token template-punctuation string\">`</span></span>\n        <span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>author<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.epub</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n      downloadUrl <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>bookItem<span class=\"token punctuation\">.</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/downloads/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>downloadPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    books<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>bookItem<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">epub</span><span class=\"token operator\">:</span> downloadUrl <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 class=\"text-2xl font-bold mt-2 mb-4 lg:text-3xl dark:text-gray-100\">Step 5: Scrape all the books from multiple pages</h2>\n<p class=\"text-md mt-2 mb-8 lg:text-lg dark:text-gray-200\">We're almost done now. The only remaining part is to scrape all the books, not just the ones from the first page. So, we'll update the code with logic to loop through all the pages to collect the metadata until the end of the last page is reached.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> puppeteer <span class=\"token keyword\">from</span> <span class=\"token string\">\"puppeteer\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">scrapeStandardEBooks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> browser <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> puppeteer<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">headless</span><span class=\"token operator\">:</span> <span class=\"token string\">\"new\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">waitForInitialPage</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> targetURL <span class=\"token operator\">=</span> <span class=\"token string\">'https://standardebooks.org/ebooks'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">goto</span><span class=\"token punctuation\">(</span>targetURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> nextPageExists <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Variable to track if next page exists</span>\n\n  <span class=\"token keyword\">const</span> books <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>nextPageExists<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> bookItems <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">$$eval</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">\"ol.ebooks-list.grid li\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token parameter\">elements</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        elements<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">element</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> element<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[property=\"schema:name\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">author</span><span class=\"token operator\">:</span> element<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[property=\"schema:author\"]'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">cover</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>\n            element<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span>\n              <span class=\"token string\">'[property=\"schema:image\"]'</span>\n            <span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> HTMLImageElement\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>\n            element<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span>\n              <span class=\"token string\">'[property=\"schema:url\"]'</span>\n            <span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> HTMLAnchorElement\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> bookItem <span class=\"token keyword\">of</span> bookItems<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// The logic for predicting downloadURL based on the bookUrl</span>\n      <span class=\"token keyword\">let</span> downloadUrl <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">const</span> regex <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\/ebooks\\/([^\\/]+)\\/([^\\/]+)(\\/([^\\/]+))?$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> match <span class=\"token operator\">=</span> bookItem<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>regex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>match<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> author<span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">,</span> translator<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> match<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> downloadPath <span class=\"token operator\">=</span> translator\n          <span class=\"token operator\">?</span> <span class=\"token comment\">// This is needed for books translated by a person different from the author</span>\n            <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>author<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>translator<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.epub</span><span class=\"token template-punctuation string\">`</span></span>\n          <span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>author<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.epub</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n        downloadUrl <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>bookItem<span class=\"token punctuation\">.</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/downloads/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>downloadPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      books<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>bookItem<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">epub</span><span class=\"token operator\">:</span> downloadUrl <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> nextPageButton <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a[rel=\"next\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    nextPageExists <span class=\"token operator\">=</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>nextPageButton<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>nextPageExists<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n        nextPageButton<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        page<span class=\"token punctuation\">.</span><span class=\"token function\">waitForNavigation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">waitUntil</span><span class=\"token operator\">:</span> <span class=\"token string\">\"networkidle0\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> books<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">scrapeStandardEBooks</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p class=\"text-md mt-2 mb-8 lg:text-lg dark:text-gray-200\">That's it! This scraper fetches all the books from Standard Ebooks and stores their metadata in nicely formatted objects.</p>\n<p class=\"text-md mt-2 mb-8 lg:text-lg dark:text-gray-200\">You could save this list in a database and write one more script to send automated emails to your Kindle with the books as attachments. Happy reading!</p>","excerpt":"If you are someone who enjoys reading classic books on your Kindle, you might already be familiar with Standard Ebooks. Standard Ebooks is a volunteer-drivenâ€¦","frontmatter":{"title":"How to Scrape Standard Ebooks using NodeJS","date":"23 Jul 2023"},"timeToRead":4},"previous":{"fields":{"slug":"/blogs/006-thankyou-opensuse/"},"frontmatter":{"title":"Thank you, openSUSE"}},"next":{"fields":{"slug":"/blogs/008-google-messages-rcs-spam-india/"},"frontmatter":{"title":"Turning on RCS in Google Messages enables spam in India"}}},"pageContext":{"id":"02740901-0c19-5f2b-89ab-2a6d6deb5434","previousPostId":"f931e808-1ae3-5580-8df9-bb0bc00256a2","nextPostId":"154af6dc-9ab4-5c8e-b6ad-ed49edeb946a"}},"staticQueryHashes":["3000541721"]}